\documentclass{beamer}

\usepackage{polyglossia}
\usepackage{fontspec}
\usepackage{nameref}
\usepackage{ifthen}
\usepackage{minted}

\usefonttheme{professionalfonts}
\usetheme{Antibes}
\useoutertheme{infolines_foot}
\setbeamercovered{transparent=20}

\usepackage[math-style=ISO,vargreek-shape=unicode]{unicode-math}

\setdefaultlanguage[spelling=modern,babelshorthands=true]{russian}
\setotherlanguage{english}

\defaultfontfeatures{Ligatures={TeX}}
\setmainfont{CMU Serif}
\setsansfont{CMU Sans Serif}
\setmonofont{CMU Typewriter Text}  
\setmathfont{Latin Modern Math}
\AtBeginDocument{\renewcommand{\setminus}{\mathbin{\backslash}}}

\makeatletter
\newcommand*{\currentname}{\@currentlabelname}
\makeatother
\def\t{\texttt}

\newcommand{\cimg}[2]{%
    \begin{center}%
        \ifthenelse{\equal{#2}{}}{%
            \includegraphics[width=0.75\linewidth]{#1}
        }{%
            \includegraphics[width=#2\linewidth]{#1}
        }%
    \end{center}%
}

\newmintinline[cinl]{c}{} %\c is defined :(
\newmintinline[cpp]{cpp}{}
\newmintinline[python]{python}{}
\newmintinline[bash]{bash}{}
\newmintinline[make]{make}{}
\setminted{obeytabs,tabsize=4,linenos,autogobble}
\newminted{c}{}
\newminted{cpp}{}
\newminted{python}{}
\newminted{bash}{}
\newminted{make}{}

\title[Война вирусов]{Война вирусов\\Походовая онлайн-игра на платформе Android}
\author{Лапшин Дмитрий, Степанов Всеволод}
\institute{СПб АУ РАН}
\date{Осень 2015}

\begin{document}

\begin{frame}
    \titlepage
\end{frame}

\section{Содержание}

\begin{frame}[t]{\currentname}
    \tableofcontents
\end{frame}

\section{О проекте}

%%Нужно больше картинок?!?
\begin{frame}[t]{Цель проекта}
    Реализовать онлайн-версию игры
    \href{https://ru.wikipedia.org/wiki/\%D0\%92\%D0\%BE\%D0\%B9\%D0\%BD\%D0\%B0\_\%D0\%B2\%D0\%B8\%D1\%80\%D1\%83\%D1\%81\%D0\%BE\%D0\%B2}{,,Война Вирусов``}
    c возможностью игры с другим игроком из списка знакомых или случайным противником.

    Игра проходит на клеточном поле $10 \times 10$, игроки по очереди ставят свои фигуры, захватывая свободные клетки и уничтожая клетки соперника.
    
    \pause
    Правила игры достаточно просты: 
    
    Игроки ходят по очереди, в каждый ход у игрока есть 3 ходика, за каждый из них можно либо занимать клетку в ,,Зоне влияния``, либо убивать чужого вируса в этой зоне.
    
    ,,Зона влияния`` -- множество клеток, соседних со своими живыми вирусами, а так же с убитыми вражескими клетками в зоне влияния
    
\end{frame}

\begin{frame}[t]{\currentname}
    Игра заканчивается, когда у кого-то из игроков все вирусы были убиты

    \cimg{01.png}{0.4}
\end{frame}

\begin{frame}[t]{Общий план}
    \begin{enumerate}
    \item
        Реализация состоит из клиентской и серверной части.
        Клиент позволяет пользователю играть, в то время как сервер соединяет клиентов и обрабатывает игры.
    \pause

    \item
        Уже прошедшие игры хранятся в базе данных: сервер хранит все, клиент хранит только свои.
    \pause
    
    \item
        Сервер и клиенты между собой общаются через систему Google Cloud Messaging, которая позваляет клиенту и серверу общаться, не тратя баттарею телефона на отдельное сетевое соединение.
    \end{enumerate}
\end{frame}
\begin{frame}[t]{Архитектура}
%%TODO:: ОЧЕНЬ хочется заиметь картиночку с архитектурой проекта
	\cimg{04.png}{0.7}
\end{frame}
\section{Клиент}

\begin{frame}[t]{Клиент}
    \begin{enumerate}
    \item
        3 режима игры: вдвоем на одном устройстве, против бота, по сети.
    \pause
    \item
        Возможность просматривать историю уже прошедших игр.
    \pause
    \item
        Текущая игра сохраняется: если приложение случайно закрылось, то всегда можно восстановить текущую игру.

        При необходимости, при игре по сети с сервера берется более актуальная версия
    \pause
    \item
        Аскетичный интерфейс

        Графика в \t{SVG} формате, чтобы идеально масштабировалось под любые размеры экранов.
		Цвета фигур выбираются игроками.
    \end{enumerate}
\end{frame}

\subsection{Бот}
\begin{frame}[t]{Бот}
    \begin{enumerate}
    \item
        Не являлся основной целью, но хотелось иметь более-менее адекватного противника
    \pause
    \item
        Эвристические подходы не очень понятны, требуют времени и сил на реализацию и проверку, поэтому стратегия переборная

    \pause
    \item
        Проблемы:
        \begin{enumerate}
            \item
                Большая ветвистость дерева перебора
            \item
                Один ход за три
            \item
                Медлительность телефонов и неоптимизированный код         
        \end{enumerate}        
    \pause
    \item
        Итоговый вариант
        \begin{enumerate}
            \item
                Перебор трех ходиков
            \item
                Играем за противника жадно еще три ходика
            \item
                Оценочная функция -- линейная комбинация количества контроллируемых клеток и клеток под ударом
        \end{enumerate}        
    \pause
    \item
        Можно улучшить, но не было времени.
    \end{enumerate}
\end{frame}

\subsection{Хранение игр}
\begin{frame}[t]{Хранение игр}
    \begin{enumerate}
        \item
            Для хранения игр, пользователей, их настроек используется \t{SQLite} база данных
        \pause
        \item
            Хранится только история ходов и идентификаторы пользователей: по этой информации можно восстановить всю игру
        \pause
        \item
            Приостановленная игра также хранится в БД.
        \pause
        \item
            Возможна синхронизация с сервером(\textit{не сделано})
    \end{enumerate}
\end{frame}

\subsection{Игра по сети}
\begin{frame}[t]{GCM}
    \begin{enumerate}
        \item
            Для взаимодействия клиент-сервер используется \t{GCM}.
                        
        \item
			Эта система связи клиента и сервера не расчитана на быстрые и большие сообщения, больше подходит для маленьких и не самых быстрых пакетов (например, push-уведомлений). Также она гарантирует доставку и маленькое потребление ресурсов. Именно то, что нам надо.
    \end{enumerate}
\end{frame}
\begin{frame}[t]{Игра по сети}
    \begin{enumerate}
        \item
            Если была уже сохраненная игра, то посылаем на сервер сообщение с просьбой обновить информацию.
                
            Иначе серверу посылается сообщение, что игрок готов играть.
        \pause
        \item
            Если игрок просит обновить игру, сервер ее обновляет

            Если хочет с кем-то поиграть, помечает игрока как ожидающего. Если уже есть ожидающие, то сервер создает между ними игру, посылает информацию о ней игрокам.
            %Говорить ли, что по факту __не совсем так__?
        \pause
        \item
            Когда игрок совершает ход, он посылает информацию об этом серверу, который пересылает ее другому игроку
        \pause
        \item
            Второй ход игрока на клиент может прийти раньше первого. Для этого у хода есть его номер, применяем ходы в порядке возрастания номеров
    \end{enumerate}
\end{frame}
\begin{frame}[t]{GSON}
    \begin{enumerate}
        \item
            По сети данные надо пересылать в каком-то формате. \t{GCM} использует для этого \t{JSON}, но из него так легко все нужные данные не достать...
            \cimg{02.png}{1.0}
        \pause
        \item
            Но тут приходит на помощь \t{GSON}! Являясь, по сути, реализацией \t{JSON} от \t{Google}, %так ведь, я чушь не сказал?
            предоставляет значительно более удобные возможности для сериализации/десериализации
            \cimg{03.png}{1.0}

    \end{enumerate}
\end{frame}
\section{Сервер}

\begin{frame}[t]{Сервер}
		\begin{enumerate}
		\item
			Поскольку сервер, по сути, только хранит и пересылает данные, то его реализация довольно компактна
			и проста.
		\pause
		\item
			Реализация сервера состоит из доступа к БД, доступа к GCM, и обработки разных видов запросов.
			\pause
			\item Сервер хранит данные в более мощной базе данных MySQL.
		\end{enumerate}
		\cimg{05.png}{0.4}
\end{frame}

\section{Сложности}
\begin{frame}[t]{Сложности}
	\begin{enumerate}
			\item API Google.

				Наш проект сильно завязан на эти API. К сожалению, \\оффициальная документация, хотя и является \\самой часто обновляемой, содержала внутренние противоречия и неточности. \\Оффициальные примеры, что ещё хуже, имели свою <<точку зрения>>.
			\pause
			\item Постоянная сериализация данных.

				Архитектура Android даёт мало возможностей для передачи данных в исходном виде, их приходится постоянно передавать в форме строк или байт. Таже данные приходится сохранять при любом скрытии активити, причём не ясно, что с ним произошло.

				\pause
			\item Отличия структуры API Android и обычной Java для доступа к сети, БД, ....
	\end{enumerate}
\end{frame}

\begin{frame}[t]{Не успели}
		\begin{enumerate}
				\item Красивый интерфейс клиента.

				\pause
				\item Честная сетевая игра -- нет регистрации.

				\pause
				\item Синхронизация данных.
		\end{enumerate}
\end{frame}

\begin{frame}[t]{Спасибо за внимание}
	\url{https://github.com/LDVSOFT/War-Of-Viruses}
\end{frame}
\end{document}
